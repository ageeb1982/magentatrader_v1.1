
@{
    ViewBag.Title = "Index";
}

<link href="/css/bootstrap.min.css" rel="stylesheet" />
<link href="/css/site.css" rel="stylesheet" />

<script src="/js/jquery.js"></script>
<script src="/lib/bootstrap/js/bootstrap.js"></script>

<script src="/js/date.js"></script>

<link href="/wijmo/styles/wijmo.min.css" rel="stylesheet" />
<script src="/js/jquery-1.10.2.min.js"></script>
<script src="/js/knockout-3.2.0.js"></script>
<script src="/wijmo/controls/wijmo.min.js" type="text/javascript"></script>
<script src="/wijmo/controls/wijmo.grid.min.js" type="text/javascript"></script>

<nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
    <div class="container topnav">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand topnav" href="/Home"><span><img src="/img/logo-1.png" /></span><span class="hidden-xs"> - Account</span></a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="container-fluid info-container-wrapper">
        <div class="col-lg-6">
            <div class="row">
                <div class="clearfix text-center">
                    <h4>Account Information</h4>
                </div>
            </div>
            <div class="info-div">
                <div class="box">
                    <div class="text">Username</div>
                </div>
                <div class="box">
                    <div class="text" id="username">dpilger</div>
                </div>
            </div>
            <div class="info-div">
                <div class="box">
                    <div class="text">First Name</div>
                </div>
                <div class="box">
                    <div class="text" id="firstname">Derek</div>
                </div>
            </div>
            <div class="info-div">
                <div class="box">
                    <div class="text">Last Name</div>
                </div>
                <div class="box">
                    <div class="text" id="lastname">Pilger</div>
                </div>
            </div>
            <div class="info-div">
                <div class="box">
                    <div class="text">Phone Number</div>
                </div>
                <div class="box">
                    <div class="text" id="phonenum">941-555-1212</div>
                </div>
            </div>
            <div class="info-div">
                <div class="box">
                    <div class="text">Email Address</div>
                </div>
                <div class="box">
                    <div class="text" id="emailadd">derekpilger@hotmail.com</div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="row">
                <div class="clearfix text-center">
                    <h4>Purchases</h4>
                </div>
            </div>
            <div id="SalesGrid" class="grid"></div>
        </div>
    </div>
</div>

@*Loading*@
<div class="modal fade" id="loading" tabindex="-1" role="dialog" aria-labelledby="Loading..." aria-hidden="true">
    <div class="modal-dialog" style="width: 220px;">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Loading...</h4>
            </div>
            <div class="modal-body">
                <img src="/img/progress_bar.gif" />
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    // Get value from cookie
    function readCookie(name) {
        var value = name + "=";
        var cookieValue = document.cookie.split(';');
        for (var i = 0; i < cookieValue.length; i++) {
            var c = cookieValue[i];
            while (c.charAt(0) == ' ')
                c = c.substring(1, c.length);
            if (c.indexOf(value) == 0)
                return c.substring(value.length, c.length);
        }
        return null;
    }

    function GetUserInfo() {
        var username = readCookie("MagentaTrader_USER");
        $('#loading').modal('show');
        $.ajax({
            url: '/api/GetUser/' + username,
            type: 'GET',
            data: {},
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            success: function (Results) {
                $('#loading').modal('hide');
                if (Results.length > 0) {
                    
                    $('#username').text(Results[0].UserName);
                    $('#firstname').text(Results[0].FirstName);
                    $('#lastname').text(Results[0].LastName);
                    $('#emailadd').text(Results[0].EmailAddress);
                    $('#phonenum').text(Results[0].PhoneNumber);
                }
                else {
                    alert("No data.");
                    $('#username, #firstname, #lastname, #emailadd, #phonenum').text("");
                }
            }
            
        }).fail(
            function (xhr, textStatus, err) {
                alert(err);
            }
        );
    }

    function GetUserPurchases() {
        var purchases = new wijmo.collections.ObservableArray(),
            username = readCookie("MagentaTrader_USER");

        $("#loading").modal('show');
        $.ajax({
            url: '/api/UserSales/' + username,
            type: 'GET',
            data: {},
            cache: false,
            contentType: 'application/json; charset=utf-8',
            success: function (Results) {
                $('#loading').modal('hide');
                if (Results.length > 0) {
                    for (i = 0; i < Results.length; i++) {
                        purchases.push({
                            SalesDate: Results[i]["SalesDate"],
                            ProductPackage: Results[i]["ProductPackage"],
                            Amount: Results[i]["Amount"],
                            ProductPackageURL: Results[i]["ProductPackageURL"]
                        });
                    } 
                } else {
                    alert("No data.");
                }
            }
        }).fail(
            function (xhr, textStatus, err) {
                alert(err);
            }
        );
        return purchases;
    }

    $(document).ready(function () {

        $('#username, #firstname, #lastname, #emailadd, #phonenum').text(". . .");

        GetUserInfo();

        Purchases = new wijmo.collections.CollectionView(GetUserPurchases());

        PurchaseGrid = new wijmo.grid.FlexGrid('#SalesGrid');

        PurchaseGrid.initialize({
            columns: [
                {
                    "header": "Sales Date",
                    "binding": "SalesDate",
                    "allowSorting": false,
                    "width": "4*"
                },
                {
                    "header": "Product Package",
                    "binding": "ProductPackage",
                    "allowSorting": false,
                    "width": "4*"
                },
                {
                    "header": "Amount",
                    "binding": "Amount",
                    "allowSorting": false,
                    "width": "4*"
                },
                {
                    "header": "Product Package URL",
                    "binding": "Product Package URL",
                    "allowSorting": false,
                    "width": "4*"
                }
            ],
            autoGenerateColumns: false,
            itemsSource: Purchases,
            isReadOnly: true,
            selectionMode: wijmo.grid.SelectionMode.Row
        });

        PurchaseGrid.trackChanges = true;

    });

</script>


<script src="/lib/jquery/js/jquery.js"></script>
<script src="/lib/bootstrap/js/bootstrap.js"></script>
<script src="/wijmo/controls/wijmo.input.min.js"></script>
<script src="/wijmo/interop/knockout/wijmo.knockout.min.js"></script>